{% extends "base.html" %}
{% load static %}

{% block title %}Create Lobby{% endblock %}

{% block welcome_text %}
    <h1 style="color: #90C83C; text-align: center;">Create a New Game Lobby</h1>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="dashboard-box p-4">
        <h2 class="text-center mb-4" style="color: #90C83C">Create New Lobby</h2>
        
        <form method="POST" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <div class="mb-4">
                <label for="lobbyName" class="form-label" style="color: #90C83C">Lobby Name</label>
                <input type="text" class="form-control bg-dark text-white" 
                       id="lobbyName" name="name" required>
            </div>

            <div class="mb-4">
                <label for="gameCode" class="form-label" style="color: #90C83C">Game Code</label>
                <input type="text" class="form-control bg-dark text-white" 
                       id="gameCode" name="code" maxlength="6" required>
                <button type="button" class="btn btn-success mt-2" onclick="generateCode()">
                    Generate Code
                </button>
            </div>

            <div class="mb-4">
                <label for="raceSelect" class="form-label" style="color: #90C83C">Select Race</label>
                <select class="form-select bg-dark text-white" id="raceSelect" name="race" required>
                    <option value="">Choose a race...</option>
                    {% for race in active_races %}
                    <div class="race-option">
                        <option value="{{ race.id }}">
                            {{ race.name }} - {{ race.time_limit_minutes }} minutes
                        </option>
                    </div>
                    {% empty %}
                    <option value="" disabled>No active races available</option>
                    {% endfor %}
                </select>
                <div class="mt-2">
                    <a href="{% url 'manage_riddles' %}" class="btn btn-success">
                        <i class="fas fa-plus"></i> Create New Race
                    </a>
                </div>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{% url 'leader_dashboard' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Create Lobby
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function generateCode() {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for (let i = 0; i < 6; i++) {
        code += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    document.getElementById('gameCode').value = code;
}

// Form validation
(function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms)
        .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
})()
</script>

<style>
.form-control, .form-select {
    border: 1px solid rgba(144, 200, 60, 0.2);
    border-radius: 8px;
}

.form-control:focus, .form-select:focus {
    border-color: #90C83C;
    box-shadow: 0 0 0 0.25rem rgba(144, 200, 60, 0.25);
}

.btn-success {
    background-color: #90C83C;
    border: none;
}

.btn-success:hover {
    background-color: #7ab32f;
}

.dashboard-box {
    background-color: rgba(33, 37, 41, 0.9);
    border-radius: 15px;
    border: 1px solid rgba(144, 200, 60, 0.2);
}
</style>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}